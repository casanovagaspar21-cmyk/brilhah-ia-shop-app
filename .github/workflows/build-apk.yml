name: Build Android APK (EAS)

on:
  workflow_dispatch:
    push:
        branches:
              - main

              jobs:
                build:
                    runs-on: ubuntu-latest
                        steps:
                              - uses: actions/checkout@v4

                                    - uses: actions/setup-node@v4
                                            with:
                                                      node-version: 20

                                                            - name: Install EAS CLI
                                                                    run: npm i -g eas-cli@latest

                                                                          - name: Install deps
                                                                                  run: npm ci || npm i

                                                                                        - name: EAS Build (APK)
                                                                                                env:
                                                                                                          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
                                                                                                                  run: |
                                                                                                                            eas build -p android --profile preview --non-interactive
                                                                                                                                      mkdir -p dist
                                                                                                                                                eas build:download --platform android --path dist/brilhah-ia-shop.apk

                                                                                                                                                      - name: Upload APK
                                                                                                                                                              uses: actions/upload-artifact@v4
                                                                                                                                                                      with:
                                                                                                                                                                                name: BRILHAH-IA-SHOP-APK
                                                                                                                                                                                          path: dist/brilhah-ia-shop.apk